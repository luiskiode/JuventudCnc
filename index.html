<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juventud CNC</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0b1020" />

  <!-- Build -->
  <script>
    window.JC_BUILD = "2025-12-20.02"; // cambia esto en cada release
  </script>

  <!-- Styles (solo una vez, versionado) -->
  <link rel="stylesheet" href="styles.css?v=2025-12-20.02" />

  <!-- Supabase SDK (SIN defer) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <!-- Config (SIN defer, debe correr despuÃ©s del SDK) -->
  <script src="supabase-config.js"></script>

  <!-- App (defer OK) -->
  <script src="app.js?v=2025-12-20.02" defer></script>
</head>

<body class="app-shell">

  <!-- OVERLAY GLOBAL -->
  <div id="overlay" class="overlay" aria-hidden="true"></div>

  <!-- DRAWER -->
  <aside id="drawer" class="drawer" aria-label="MenÃº lateral">
    <div class="drawer-header">
      <h2>Juventud CNC</h2>
      <button id="closeDrawer" class="icon-btn" type="button" aria-label="Cerrar menÃº">âœ•</button>
    </div>

    <nav class="drawer-nav" aria-label="Secciones">
      <a href="#inicio" data-tab="inicio">ğŸ  Inicio</a>
      <a href="#eventos" data-tab="eventos">ğŸ“… Eventos</a>
      <a href="#comunidad" data-tab="comunidad">ğŸ‘¥ Comunidad</a>
      <button type="button" data-tab="box" class="drawer-link">ğŸ“¦ Box</button>
      <hr />

      <a href="#perfil" data-tab="perfil">ğŸ‘¤ Mi perfil</a>
      <a href="#judart" data-tab="judart">ğŸ¨ Judart</a>
      <a href="#recursos" data-tab="recursos">ğŸ“‚ Recursos</a>

      <hr />

      <a href="#miembros-activos" data-tab="miembros-activos">â­ Miembros</a>
    </nav>

    <footer class="drawer-footer">
      v1.0 Â· Juventud CNC ğŸ’™ğŸ’—
    </footer>
  </aside>

  <!-- TOPBAR -->
  <header class="topbar" role="banner">
    <button id="openDrawer" class="icon-btn" type="button" aria-label="Abrir menÃº">â˜°</button>

    <h1 class="topbar-title">Juventud CNC</h1>

    <div class="topbar-actions" aria-label="Acciones">
      <select id="themePicker" class="theme-picker" aria-label="Tema">
        <option value="auto">Auto</option>
        <option value="chicos">Chicos ğŸ’™</option>
        <option value="chicas">Chicas ğŸ’—</option>
        <option value="mix">Mix ğŸ’™ğŸ’—</option>
      </select>

      <!-- ğŸ¤– (Se inyecta desde app.js si no existe; lo dejamos listo para estilos/orden) -->
      <button id="btnBots" class="icon-btn" type="button" title="Encender / Apagar bots" aria-label="Encender o apagar bots">ğŸ¤–</button>

      <!-- Angie -->
      <button id="btnAngie" class="icon-btn" type="button" title="DiseÃ±o Angie" aria-label="DiseÃ±o Angie">ğŸ¨</button>

      <button id="btnLogin" class="icon-btn" type="button" title="Iniciar sesiÃ³n" aria-label="Iniciar sesiÃ³n">ğŸ”‘</button>


      <!-- Perfil -->
      <button id="btnPerfil" class="icon-btn" type="button" data-tab="perfil" title="Mi perfil" aria-label="Mi perfil">ğŸ‘¤</button>
    </div>
  </header>

  <!-- CONTENIDO -->
  <main class="container" id="main">

    <!-- INICIO -->
    <section class="view active" data-view="inicio" aria-label="Inicio">
      <section class="card" id="mensaje-semanal">
        <header class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ•Šï¸">Mensaje semanal</h2>
          <span class="badge badge-mix">Para todos</span>
        </header>

        <article class="card-body">
          <h3 id="msgTitle">Cargando mensaje...</h3>
          <p id="msgBody">Un momentoâ€¦</p>
          <small id="msgMeta"></small>
        </article>
      </section>

      <section class="card hero" aria-label="Bienvenida">
        <div>
          <h2>Bienvenido a Juventud CNC</h2>
          <p>Un espacio para crecer, servir y caminar juntos.</p>
          <p class="small" style="margin-top:8px; opacity:.95">
            Consejo rÃ¡pido: usa <strong>ğŸ¤–</strong> para encender/apagar bots, y <strong>ğŸ¨</strong> para el diseÃ±o de Angie.
          </p>
        </div>
      </section>

      <section class="card" aria-label="Eventos prÃ³ximos">
        <div class="card-header">
          <h3 class="with-emoji" data-emoji="ğŸ“…">PrÃ³ximos eventos</h3>
          <a href="#eventos" data-tab="eventos" class="link">Ver todos</a>
        </div>
        <ul id="eventListHome" class="event-list"></ul>
      </section>
    </section>

    <!-- EVENTOS -->
    <section class="view" data-view="eventos" aria-label="Eventos">
      <section class="card">
        <header class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ“…">Eventos</h2>
          <select id="filtroTipo" aria-label="Filtrar por tipo">
            <option value="">Todos</option>
            <option value="formacion">FormaciÃ³n</option>
            <option value="servicio">Servicio</option>
            <option value="convivencia">Convivencia</option>
            <option value="oracion">OraciÃ³n</option>
          </select>
        </header>

        <form id="formEvento" class="grid perfil-form" aria-label="Crear evento">
          <input id="evTitulo" placeholder="TÃ­tulo" required />
          <input id="evFecha" type="datetime-local" required />
          <input id="evLugar" placeholder="Lugar" />
          <select id="evTipo" aria-label="Tipo">
            <option value="">Tipo</option>
            <option value="formacion">FormaciÃ³n</option>
            <option value="servicio">Servicio</option>
            <option value="convivencia">Convivencia</option>
            <option value="oracion">OraciÃ³n</option>
          </select>
          <button class="btn small" type="submit">Guardar</button>
          <p id="evEstado" class="small muted"></p>
        </form>

        <ul id="eventList" class="event-list"></ul>
      </section>
    </section>

    <section class="view" data-view="box" id="viewBox">
  <div class="box-wrap">
    <h2 class="box-title">ğŸ“¦ Box</h2>
    <p class="muted small">AquÃ­ vive el chat de Mia, Ciro y Angie. (Ya no tapa el celular.)</p>

    <!-- AquÃ­ montamos el chat -->
    <div id="boxChatMount"></div>
  </div>
</section>


    <!-- COMUNIDAD -->
    <!-- COMUNIDAD -->
<section class="view" data-view="comunidad" aria-label="Comunidad">
  <section class="card">
    <header class="card-header">
      <div>
        <h2 class="with-emoji" data-emoji="ğŸ‘¥">Comunidad</h2>
        <p class="muted small">Retos + dinÃ¡micas + foro. Solo miembros registrados publican, comentan y reaccionan â¤ï¸</p>
      </div>
      <span id="comuLockBadge" class="badge badge-mix">ğŸ”’ Solo miembros</span>
    </header>

    <!-- Tabs -->
    <div class="comu-tabs" role="tablist" aria-label="CategorÃ­as de comunidad">
      <button class="comu-tab active" type="button" data-comu-cat="chicos" role="tab" aria-selected="true">ğŸ’™ Retos chicos</button>
      <button class="comu-tab" type="button" data-comu-cat="chicas" role="tab" aria-selected="false">ğŸ’— Retos chicas</button>
      <button class="comu-tab" type="button" data-comu-cat="dinamicas" role="tab" aria-selected="false">ğŸ”„ DinÃ¡micas</button>
      <button class="comu-tab" type="button" data-comu-cat="foro" role="tab" aria-selected="false">ğŸ’¬ Foro</button>
    </div>

    <!-- Estado de acceso -->
    <div id="comuGate" class="comu-gate muted small" style="margin-top:10px">
      Cargando estadoâ€¦
    </div>

    <!-- Crear publicaciÃ³n (solo miembros; se oculta por JS si no estÃ¡ logueado/registrado) -->
    <div id="comuComposer" class="comu-composer" style="margin-top:12px; display:none">
      <div class="comu-composer-head">
        <strong>Publicar</strong>
        <span class="muted small">Comparte una idea, reto o dinÃ¡mica</span>
      </div>

      <form id="formComuPost" class="grid comu-form" aria-label="Crear publicaciÃ³n comunidad">
        <input id="comuTitulo" maxlength="120" placeholder="TÃ­tulo (ej: Reto de la semana)" required />
        <textarea id="comuContenido" rows="3" maxlength="4000" placeholder="Escribe tu publicaciÃ³nâ€¦" required></textarea>

        <div class="comu-actions">
          <button class="btn" type="submit">Publicar</button>
          <button id="btnComuClear" class="btn ghost" type="button">Limpiar</button>
        </div>

        <p id="comuEstado" class="small muted" style="margin:0"></p>
      </form>
    </div>

    <!-- Feed -->
    <div class="comu-feed" style="margin-top:14px">
      <div class="comu-feed-head">
        <h3 class="with-emoji" data-emoji="ğŸ“°">Publicaciones</h3>
        <button id="btnComuRefresh" class="btn small ghost" type="button">Actualizar</button>
      </div>

      <div id="comuList" class="comu-list">
        <div class="muted small">Cargando publicacionesâ€¦</div>
      </div>
    </div>
  </section>

  <!-- Modal comentarios -->
  <div id="comuModal" class="jc-modal" style="display:none">
    <div class="jc-modal-card" role="dialog" aria-modal="true" aria-label="Comentarios comunidad">
      <header class="jc-modal-header">
        <div>
          <h3 id="comuModalTitle">Comentarios</h3>
          <p id="comuModalMeta" class="muted small">â€”</p>
        </div>
        <button id="comuModalClose" class="icon-btn" type="button">âœ•</button>
      </header>

      <div class="jc-modal-body">
        <div id="comuCommentsList" class="comu-comments"></div>

        <!-- Form comentario -->
        <div id="comuCommentComposer" class="comu-composer" style="margin-top:12px; display:none">
          <form id="formComuComment" class="grid comu-form" aria-label="Agregar comentario">
            <textarea id="comuCommentText" rows="2" maxlength="1500" placeholder="Escribe un comentarioâ€¦" required></textarea>
            <div class="comu-actions">
              <button class="btn" type="submit">Comentar</button>
              <button id="btnComuCommentClear" class="btn ghost" type="button">Limpiar</button>
            </div>
            <p id="comuCommentEstado" class="small muted" style="margin:0"></p>
          </form>
        </div>

        <div id="comuCommentGate" class="muted small" style="margin-top:10px">
          ğŸ”’ RegÃ­strate para comentar.
        </div>
      </div>
    </div>
  </div>
</section>

    <!-- PERFIL -->
    <section class="view" data-view="perfil" aria-label="Perfil">
      <section class="card perfil-card">
        <h2 class="with-emoji" data-emoji="ğŸ‘¤">Mi perfil</h2>

        <div class="perfil-resumen">
          <div class="perfil-avatar" id="perfilAvatar" aria-label="Foto de perfil">
  <img id="perfilAvatarImg" alt="Foto de perfil" style="display:none" />
  <span id="perfilAvatarInitial">ğŸ‘¤</span>
</div>        
          
          <div>
            <strong id="perfilNombreTexto">AÃºn sin registrar</strong>
            <div id="perfilRolTexto" class="small muted"></div>
          </div>
          <button id="btnCerrarPerfil" class="btn small" type="button" style="display:none">
            Cerrar sesiÃ³n
          </button>
        </div>

        <p id="perfilFraseTexto" class="perfil-frase">
          AquÃ­ aparecerÃ¡ tu frase.
        </p>

        <p id="perfilEstado" class="small muted"></p>

        <div class="perfil-avatar-tools">
  <label class="btn small ghost" for="perfilAvatarInput">ğŸ“· Subir foto</label>
  <input id="perfilAvatarInput" type="file" accept="image/*" style="display:none" />
  <button id="btnAvatarClear" class="btn small ghost" type="button">Quitar</button>
</div>

        <form id="formMiembro" class="grid perfil-form" aria-label="Formulario de perfil">
          <input name="nombre" placeholder="Nombre completo" required />
          <input name="edad" type="number" min="10" max="99" placeholder="Edad" required />
          <input name="contacto" placeholder="Celular" />
          <input name="ministerio" placeholder="Ministerio (opcional)" />

          <select name="rol_key" aria-label="Rol">
            <option value="miembro">Miembro</option>
            <option value="voluntario">Voluntario digital</option>
            <option value="moderador">Moderador</option>
          </select>

          <input name="frase" placeholder="Frase personal" />
          <button class="btn" type="submit">Guardar perfil</button>
        </form>
      </section>
    </section>

    <!-- JUDART -->
    <section class="view" data-view="judart" aria-label="Judart">
      <section class="card">
        <h2 class="with-emoji" data-emoji="ğŸ¨">Judart</h2>
        <p class="muted">Espacio creativo: arte, ilustraciÃ³n, identidad juvenil.</p>

        <div class="grid" style="margin-top:12px; gap:10px">
          <div class="card" style="padding:12px">
            <h3 class="with-emoji" data-emoji="ğŸ–¼ï¸">GalerÃ­a</h3>
            <p class="small muted">PrÃ³ximamente: mural digital, fotos, artes del grupo.</p>
          </div>
          <div class="card" style="padding:12px">
            <h3 class="with-emoji" data-emoji="âœ¨">Identidad</h3>
            <p class="small muted">Logos, colores, estilos y diseÃ±os.</p>
          </div>
          <div class="card" style="padding:12px">
            <h3 class="with-emoji" data-emoji="ğŸ“Œ">Avisos</h3>
            <p class="small muted">Los avisos ahora viven aquÃ­ (modo creativo).</p>
          </div>
        </div>

        <!-- Compat: si en algÃºn momento tenÃ­as un botÃ³n de notificaciones, app.js lo redirige a Judart -->
        <button id="btnPermPush" class="btn" type="button" style="margin-top:12px">
          Abrir Judart (modo arte)
        </button>
      </section>
    </section>

    <!-- RECURSOS -->
    <section class="view" data-view="recursos" aria-label="Recursos">
      <section class="card">
        <div class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ“‚">Recursos</h2>
          <small class="muted">Tip: en esta vista el botÃ³n <strong>ï¼‹</strong> abre el selector de archivos</small>
        </div>

        <!-- input oculto que usa app.js -->
        <input id="fileRec" type="file" style="display:none" />

        <div id="listaRecursos"></div>
      </section>
    </section>

    <!-- MIEMBROS -->
    <section class="view" data-view="miembros-activos" aria-label="Miembros">
      <section class="card">
        <h2 class="with-emoji" data-emoji="â­">Miembros registrados</h2>
        <ul id="listaMiembros" class="user-list"></ul>
      </section>
    </section>

  </main>

  <!-- TABS -->
  <nav class="tabs" aria-label="NavegaciÃ³n inferior">
    <button class="tab active" type="button" data-tab="inicio">ğŸ <span>Inicio</span></button>
    <button class="tab" type="button" data-tab="eventos">ğŸ“…<span>Eventos</span></button>
    <button class="tab" type="button" data-tab="comunidad">ğŸ‘¥<span>Comunidad</span></button>
    <button class="tab" type="button" data-tab="recursos">ğŸ“‚<span>Recursos</span></button>
    <button class="tab" type="button" data-tab="judart">ğŸ¨<span>Judart</span></button>
  </nav>

  <!-- FAB (acciÃ³n rÃ¡pida) -->
  <button id="fab" class="fab" type="button" aria-label="AcciÃ³n rÃ¡pida">ï¼‹</button>

  <!-- =========================
       WIDGETS BOTS (Angie / Mia / Ciro)
       app.js espera estos IDs
       ========================= -->

  <!-- Angie -->
  <div id="angieWidget" class="angie-widget" aria-label="Angie">
    <div class="bot-bubble angie-bubble">
      <button id="angieClose" class="bot-close" type="button" aria-label="Cerrar Angie">âœ•</button>
      <div class="bot-name angie-name">Angie</div>
      <div id="angieText">Â¡Holaaa! QuÃ© bueno verte ğŸ˜„</div>
    </div>

    <div class="bot-avatar angie-avatar">
      <img id="angieAvatarImg" src="assets/angie-feliz-saludo.png" alt="Angie" />
    </div>
  </div>

  <!-- Mia -->
  <div id="miaWidget" class="mia-widget" aria-label="Mia">
    <div class="bot-bubble mia-bubble">
      <button id="miaClose" class="bot-close" type="button" aria-label="Cerrar Mia">âœ•</button>
      <div class="bot-name mia-name">Mia</div>
      <div id="miaText">Soy Mia. AquÃ­ todo lo coordinamos con calma ğŸ’—</div>
    </div>

    <div class="bot-avatar mia-avatar">
      <img id="miaAvatarImg" src="assets/mia-casual-wink.png" alt="Mia" />
    </div>
  </div>

  <!-- Ciro -->
  <div id="ciroWidget" class="ciro-widget" aria-label="Ciro">
    <div class="bot-bubble ciro-bubble">
      <button id="ciroClose" class="bot-close" type="button" aria-label="Cerrar Ciro">âœ•</button>
      <div class="bot-name ciro-name">Ciro</div>
      <div id="ciroText">Â¡Holaaa! Â¡Vamos con fuerza! ğŸ’ªğŸ”¥</div>
    </div>

    <div class="bot-avatar ciro-avatar">
      <img id="ciroAvatarImg" src="assets/ciro-happy.png" alt="Ciro" />
    </div>
  </div>

  <!-- CHAT BOTS (app.js lo crea si falta, pero aquÃ­ queda fijo y pulido) -->
  <section id="jcChat" class="jc-chat" aria-label="Chat de bots">
    <header class="jc-chat-header">
      <div class="jc-chat-title">
        <span class="dot-online" aria-hidden="true"></span>
        <span>Chat bots</span>
      </div>
      <button class="jc-chat-toggle" id="jcChatToggle" type="button" aria-label="Colapsar chat">âŒ„</button>
    </header>
    <div class="jc-chat-body" id="jcChatBody"></div>
  </section>


  <!-- LOGIN MODAL -->
<div id="loginModal" class="jc-modal" style="display:none">
  <div class="jc-modal-card" role="dialog" aria-modal="true" aria-label="Iniciar sesiÃ³n">
    <header class="jc-modal-header">
      <div>
        <h3>ğŸ”‘ Iniciar sesiÃ³n</h3>
        <p class="muted small">Te enviamos un enlace a tu correo (Magic Link).</p>
      </div>
      <button id="loginClose" class="icon-btn" type="button">âœ•</button>
    </header>

    <div class="jc-modal-body">
      <form id="loginForm" class="grid perfil-form" aria-label="Formulario login">
        <input id="loginEmail" type="email" placeholder="tu-correo@gmail.com" required />
        <button class="btn" type="submit">Enviar enlace</button>
        <p id="loginEstado" class="small muted" style="margin:0"></p>
      </form>

      <div class="muted small" style="margin-top:10px">
        ğŸ’¡ Tip: si ya estÃ¡s logueado, verÃ¡s tu perfil sin formulario.
      </div>
    </div>
  </div>
</div>

</body>
</html>
