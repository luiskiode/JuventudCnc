<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Juventud CNC</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <meta name="theme-color" content="#0b1020" />

  <!-- SDKs -->
  <script src="https://unpkg.com/@supabase/supabase-js@2" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-app-compat.js" defer></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.2/firebase-messaging-compat.js" defer></script>

  <!-- Config -->
  <script src="supabase-config.js" defer></script>
  <!-- <script src="firebase-config.js" defer></script> -->

  <!-- Herramientas -->
  <script src="design-mode.js" defer></script>
  <script src="debug-dashboard.js" defer></script>
</head>

<body class="app-shell">

  <!-- Drawer -->
  <aside id="drawer" class="drawer">
    <div class="drawer-header">
      <h2>Juventud CNC</h2>
      <button id="closeDrawer" class="icon-btn">âœ•</button>
    </div>

    <nav class="drawer-nav">
      <a data-tab="inicio">Inicio</a>
      <a data-tab="eventos">Eventos</a>
      <a data-tab="comunidad">Comunidad</a>
      <a data-tab="perfil">Mi perfil</a>
      <a data-tab="recursos">Recursos</a>
      <a data-tab="avisos">Avisos</a>
      <a data-tab="miembros-activos">Miembros</a>
    </nav>

    <footer class="drawer-footer">v1.0 â€¢ Pensado para jÃ³venes ğŸ’™ğŸ’—</footer>
  </aside>

  <div id="overlay" class="overlay"></div>

  <!-- Topbar -->
  <header class="topbar">
    <button id="openDrawer" class="icon-btn">â˜°</button>
    <h1 class="topbar-title">Juventud CNC</h1>

    <div class="topbar-actions">
      <select id="themePicker" class="theme-picker">
        <option value="auto">Auto</option>
        <option value="chicos">Chicos ğŸ’™</option>
        <option value="chicas">Chicas ğŸ’—</option>
        <option value="mix">Mix ğŸ’™ğŸ’—</option>
      </select>

      <button id="btnAngie" class="icon-btn">ğŸ¨</button>
      <button id="btnPerfil" class="icon-btn">ğŸ‘¤</button>
    </div>
  </header>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container" id="main">

    <!-- INICIO -->
    <section class="view active" id="view-inicio" data-view="inicio">
      <section class="card" id="mensaje-semanal">
        <header class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ•Šï¸">Mensaje semanal</h2>
          <span class="badge badge-mix">Para chicos ğŸ’™ y chicas ğŸ’—</span>
        </header>

        <article class="card-body">
          <h3 id="msgTitle">Cargando mensaje...</h3>
          <p id="msgBody">
            AquÃ­ aparecerÃ¡ una palabra breve para acompaÃ±ar tu semana.
          </p>
          <small id="msgMeta">â€“</small>
        </article>
      </section>

      <!-- Hero -->
      <section class="card hero">
        <div class="hero-content">
          <h2>Bienvenido a Juventud CNC</h2>
          <p>Un solo espacio para crecer, servir y encontrarse con Dios.</p>
          <div class="hero-badges">
            <span class="badge badge-guy">Chicos ğŸ’™</span>
            <span class="badge badge-girl">Chicas ğŸ’—</span>
          </div>
        </div>
        <div class="hero-icons">âœï¸<span class="hero-gradient-bubbles"></span></div>
      </section>

      <!-- Lista rÃ¡pida de eventos -->
      <section class="card">
        <div class="card-header">
          <h3 class="with-emoji" data-emoji="ğŸ“…">PrÃ³ximos eventos</h3>
          <a data-tab="eventos" class="link">Ver todos</a>
        </div>

        <ul id="eventListHome" class="event-list"></ul>

        <p class="muted small">
          AquÃ­ verÃ¡s los prÃ³ximos 4 eventos.
        </p>
      </section>
    </section>

    <!-- EVENTOS -->
    <section class="view" id="view-eventos" data-view="eventos">
      <section class="card">

        <header class="card-header">
          <div>
            <h2 class="with-emoji" data-emoji="ğŸ“…">Eventos</h2>
            <p class="muted small">Agenda parroquial y actividades.</p>
          </div>

          <div class="card-header-actions">
            <label class="muted small">Filtrar</label>
            <select id="filtroTipo">
              <option value="">Todos</option>
              <option value="formacion">FormaciÃ³n</option>
              <option value="servicio">Servicio</option>
              <option value="convivencia">Convivencia</option>
              <option value="oracion">OraciÃ³n</option>
            </select>
          </div>
        </header>

        <!-- Formulario -->
        <form id="formEvento" class="grid perfil-form">
          <p class="small muted">
            Crea nuevos eventos para el grupo.
          </p>

          <input id="evTitulo" placeholder="TÃ­tulo del evento" required />
          <div class="grid">
            <input id="evFecha" type="datetime-local" required />
            <select id="evTipo">
              <option value="">Tipo</option>
              <option value="formacion">FormaciÃ³n</option>
              <option value="servicio">Servicio</option>
              <option value="convivencia">Convivencia</option>
              <option value="oracion">OraciÃ³n</option>
            </select>
          </div>

          <input id="evLugar" placeholder="Lugar" />
          <input id="evDescripcion" placeholder="DescripciÃ³n (opcional)" />

          <button class="btn small" type="submit">Guardar evento</button>
          <p id="evEstado" class="perfil-estado small"></p>
        </form>

        <!-- Lista -->
        <ul id="eventList" class="event-list"></ul>
      </section>
    </section>

    <!-- COMUNIDAD -->
    <section class="view" id="view-comunidad" data-view="comunidad">
      <section class="card">
        <h2 class="with-emoji" data-emoji="ğŸ‘¥">Comunidad</h2>
        <p class="muted">
          Tu registro se gestiona desde <strong>Mi perfil</strong>.
        </p>
      </section>

      <section class="card">
        <h3 class="with-emoji" data-emoji="â­">Comunidad activa</h3>
        <div class="grid grid-compact">
          <button class="chip chip-guy" data-action="retos">ğŸ’ª Retos</button>
          <button class="chip chip-girl" data-action="retos-chicas">âœ¨ Retos chicas</button>
          <button class="chip" data-action="noticias">ğŸ“° Noticias</button>
          <button class="chip" data-action="multimedia">ğŸ¶ Multimedia</button>
          <button class="chip" data-action="foro">ğŸ’¬ Foro</button>
        </div>
      </section>
    </section>

    <!-- MIEMBROS -->
    <section class="view" id="view-miembros-activos" data-view="miembros-activos">
      <section class="card">
        <h2 class="with-emoji" data-emoji="ğŸ‘¤">Miembros registrados</h2>
        <p class="muted small">Usuarios inscritos.</p>
        <ul id="listaMiembros" class="user-list"></ul>
      </section>
    </section>

    <!-- PERFIL -->
    <section class="view" id="view-perfil" data-view="perfil">
      <section class="card perfil-card">

        <div class="perfil-header">
          <div class="perfil-avatar-wrapper">
            <div class="perfil-avatar" id="perfilAvatar">
              <span id="perfilAvatarInicial">ğŸ™‚</span>
              <img id="perfilAvatarImg" alt="Foto" />
            </div>

            <button id="btnCambiarFoto" class="btn small perfil-foto-btn">
              Cambiar foto
            </button>

            <input id="perfilFotoInput" type="file" accept="image/*" hidden />
          </div>

          <div class="perfil-header-text">
            <h2 class="with-emoji" data-emoji="ğŸ™‹â€â™‚ï¸">Mi perfil</h2>
            <p class="perfil-subtext">RegÃ­strate una sola vez.</p>
          </div>
        </div>

        <div class="perfil-resumen">
          <div>
            <div class="perfil-nombre" id="perfilNombreTexto">AÃºn sin registrar</div>
            <div class="perfil-rol" id="perfilRolTexto"></div>
          </div>

          <button id="btnCerrarPerfil" class="btn small perfil-logout-btn" style="display:none;">
            Cerrar sesiÃ³n
          </button>
        </div>

        <p id="perfilFraseTexto" class="perfil-frase">
          AquÃ­ aparecerÃ¡ la frase elegida.
        </p>

        <p id="perfilEstado" class="perfil-estado"></p>

        <!-- Formulario -->
        <form id="formMiembro" class="grid perfil-form">

          <input id="perfilNombreInput" placeholder="Nombre y apellido" required />
          <input type="number" min="10" max="99" placeholder="Edad" name="edad" required />
          <input type="tel" placeholder="Contacto (celular)" name="contacto" />

          <input placeholder="Ministerio / grupo (opcional)" name="ministerio" />

          <select id="perfilRolSelect" name="rol_key">
            <option value="miembro">Miembro</option>
            <option value="voluntario">Voluntario digital</option>
            <option value="moderador">Moderador (solicitud)</option>
          </select>

          <input id="perfilFraseInput" placeholder="Frase para tu perfil" name="frase" />

          <button class="btn" type="submit">Guardar perfil</button>
        </form>

      </section>
    </section>

    <!-- RECURSOS -->
    <section class="view" id="view-recursos" data-view="recursos">
      <section class="card">
        <header class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ“‚">Recursos</h2>

          <label class="btn small adminOnly" hidden>
            Subir archivo
            <input id="fileRec" type="file" hidden />
          </label>
        </header>

        <ul id="listaRecursos" class="file-list"></ul>
      </section>
    </section>

    <!-- AVISOS -->
    <section class="view" id="view-avisos" data-view="avisos">
      <section class="card">
        <header class="card-header">
          <h2 class="with-emoji" data-emoji="ğŸ””">Avisos</h2>
          <button id="btnPermPush" class="btn small">Activar notificaciones</button>
        </header>

        <ul id="avisosList" class="notice-list"></ul>
      </section>
    </section>

  </main>

  <!-- TABS -->
  <nav class="tabs">
    <button class="tab active" data-tab="inicio">ğŸ <span>Inicio</span></button>
    <button class="tab" data-tab="eventos">ğŸ“…<span>Eventos</span></button>
    <button class="tab" data-tab="comunidad">ğŸ‘¥<span>Comunidad</span></button>
    <button class="tab" data-tab="recursos">ğŸ“‚<span>Recursos</span></button>
    <button class="tab" data-tab="avisos">ğŸ””<span>Avisos</span></button>
  </nav>

  <button id="fab" class="fab">ï¼‹</button>
  <button id="btnInstallApp" class="btn-install" style="display:none;">ğŸ“² Instalar app</button>

  <!-- Panel Angie -->
  <aside id="angie-panel" class="sidepanel">
    <div class="sidepanel-header">
      <h2>Paleta de colores (Angie)</h2>
      <button id="closeAngiePanel" class="icon-btn">âœ•</button>
    </div>

    <iframe src="Angie herramienta.html" class="sidepanel-iframe"></iframe>
  </aside>

  <!-- WIDGETS: Ciro -->
  <div class="angie-widget ciro-widget" id="ciroWidget">
    <div class="angie-avatar">
      <img src="assets/ciro-happy.png" id="ciroAvatarImg" alt="Ciro" />
    </div>

    <div class="angie-bubble">
      <div class="angie-bubble-header">
        <span class="angie-name">Ciro</span>
        <button id="ciroClose" class="angie-close">Ã—</button>
      </div>

      <p id="ciroText">Estoy atento a lo que necesites ğŸ™Œ</p>
    </div>
  </div>

  <!-- WIDGET: Mia -->
  <div class="angie-widget mia-widget" id="miaWidget">
    <div class="angie-avatar">
      <img src="assets/mia-casual-wink.png" id="miaAvatarImg" alt="Mia" />
    </div>

    <div class="angie-bubble">
      <div class="angie-bubble-header">
        <span class="angie-name">Mia</span>
        <button id="miaClose" class="angie-close">Ã—</button>
      </div>

      <p id="miaText">Soy Mia, coordinamos todo este espacio ğŸ’—</p>
    </div>
  </div>

  <!-- WIDGET: Angie -->
  <div class="angie-widget" id="angieWidget">
    <div class="angie-avatar">
      <img src="assets/angie-feliz-saludo.png" id="angieAvatarImg" alt="Angie" />
    </div>

    <div class="angie-bubble">
      <div class="angie-bubble-header">
        <span class="angie-name">Angie</span>
        <button id="angieClose" class="angie-close">Ã—</button>
      </div>

      <p id="angieText">Hola, estoy aquÃ­ para ayudarte ğŸ’—</p>
    </div>
  </div>

  <!-- CHAT -->
  <section class="jc-chat" id="jcChat">
    <header class="jc-chat-header">
      <div class="jc-chat-title"><span class="dot-online"></span>Juventud CNC Â· Chat</div>
      <button id="jcChatToggle" class="jc-chat-toggle">â–¾</button>
    </header>

    <div class="jc-chat-body" id="jcChatBody"></div>
  </section>

  <!-- APP JS -->
  <script src="app.js" defer></script>

  <!-- Panel Angie / Tokens -->
  <script>
  (function () {
    const panel = document.getElementById("angie-panel");
    const btn = document.getElementById("btnAngie");
    const closeBtn = document.getElementById("closeAngiePanel");
    const overlay = document.getElementById("overlay");
    const themePicker = document.getElementById("themePicker");

    function openPanel() {
      panel.classList.add("open");
      overlay.classList.add("show");
    }
    function closePanel() {
      panel.classList.remove("open");
      overlay.classList.remove("show");
    }

    btn.addEventListener("click", openPanel);
    closeBtn.addEventListener("click", closePanel);
    overlay.addEventListener("click", () => {
      if (panel.classList.contains("open")) closePanel();
    });

    window.addEventListener("message", (ev) => {
      if (!ev.data) return;

      if (ev.data.type === "applyTokens" && window.jcApplyTokens) {
        window.jcApplyTokens(ev.data.tokens);
      }

      if (ev.data.type === "angieEstado" && window.angieSetEstado) {
        window.angieSetEstado(ev.data.value);
      }
    });

    window.addEventListener("keydown", (e) => {
      if (e.ctrlKey && e.altKey && e.key.toLowerCase() === "a") {
        panel.classList.contains("open") ? closePanel() : openPanel();
      }
      if (e.key === "Escape" && panel.classList.contains("open")) closePanel();
    });

    const params = new URLSearchParams(window.location.search);
    if (params.has("angie")) openPanel();

    function applyTokens(tokens) {
      if (!tokens) return;
      const root = document.documentElement;

      Object.entries(tokens).forEach(([key, val]) => {
        root.style.setProperty(`--${key}`, val);
      });
    }

    window.jcApplyTokens = applyTokens;

    (function restoreTokensOnLoad() {
      try {
        const saved = localStorage.getItem("jc_tokens");
        if (saved) {
          const tokens = JSON.parse(saved);
          applyTokens(tokens);
          console.log("ğŸ’¾ Paleta restaurada");
        }
      } catch (e) {
        console.error("Error con jc_tokens:", e);
      }
    })();

  })();
  </script>

</body>
</html>